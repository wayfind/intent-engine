# Intent-Engine Log Rotation Configuration
# Place this file in /etc/logrotate.d/intent-engine
#
# Installation:
#   sudo cp docs/deployment/logrotate.conf /etc/logrotate.d/intent-engine
#   sudo chmod 644 /etc/logrotate.d/intent-engine
#
# Test configuration:
#   sudo logrotate -d /etc/logrotate.d/intent-engine
#
# Force rotation (for testing):
#   sudo logrotate -f /etc/logrotate.d/intent-engine

# Dashboard log rotation
~/.intent-engine/logs/dashboard.log {
    # Rotate daily
    daily

    # Keep 7 days of logs
    rotate 7

    # Compress old logs
    compress
    delaycompress

    # Don't error if log file is missing
    missingok

    # Don't rotate if log is empty
    notifempty

    # Create new log file with these permissions
    create 0640 $USER $USER

    # Use date as suffix for rotated files (e.g., dashboard.log-20251122)
    dateext
    dateformat -%Y%m%d

    # Post-rotation script (optional)
    # Reload dashboard if running
    postrotate
        # Send SIGHUP to dashboard if it's running
        # This tells the dashboard to reopen log files
        pkill -HUP -f "ie dashboard" 2>/dev/null || true
    endscript
}

# MCP Server log rotation
~/.intent-engine/logs/mcp-server.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 $USER $USER
    dateext
    dateformat -%Y%m%d

    postrotate
        pkill -HUP -f "ie mcp-server" 2>/dev/null || true
    endscript
}

# CLI log rotation (if enabled)
~/.intent-engine/logs/cli.log {
    daily
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 0640 $USER $USER
    dateext
    dateformat -%Y%m%d
}

# Size-based rotation alternative (uncomment to use)
# ~/.intent-engine/logs/dashboard.log {
#     size 10M
#     rotate 5
#     compress
#     delaycompress
#     missingok
#     notifempty
#     create 0640 $USER $USER
# }
