# ç‰¹æ®Šå­—ç¬¦å’Œè¾¹ç•Œæƒ…å†µå¤„ç†

æœ¬æ–‡æ¡£è¯´æ˜ Intent-Engine å¯¹å„ç§ç‰¹æ®Šå­—ç¬¦ã€Unicodeã€æç«¯è¾“å…¥çš„å¤„ç†èƒ½åŠ›ã€‚

## æµ‹è¯•è¦†ç›–æ¦‚è§ˆ

Intent-Engine ç»è¿‡å…¨é¢æµ‹è¯•ï¼ŒéªŒè¯äº†å¯¹ä»¥ä¸‹è¾“å…¥çš„æ­£ç¡®å¤„ç†ï¼š

- âœ… SQL æ³¨å…¥é˜²æŠ¤
- âœ… Unicode å­—ç¬¦ï¼ˆä¸­æ–‡ã€æ—¥æ–‡ã€é˜¿æ‹‰ä¼¯æ–‡ç­‰ï¼‰
- âœ… Emoji è¡¨æƒ…ç¬¦å·
- âœ… JSON ç‰¹æ®Šå­—ç¬¦
- âœ… æ§åˆ¶å­—ç¬¦ï¼ˆæ¢è¡Œã€åˆ¶è¡¨ç¬¦ç­‰ï¼‰
- âœ… æé•¿è¾“å…¥ï¼ˆ10,000+ å­—ç¬¦ï¼‰
- âœ… è¾¹ç•Œæƒ…å†µï¼ˆç©ºå­—ç¬¦ä¸²ã€çº¯ç©ºæ ¼ç­‰ï¼‰
- âœ… Shell å…ƒå­—ç¬¦
- âœ… Markdown/HTML æ ‡ç­¾
- âœ… URL å’Œè·¯å¾„

## å®‰å…¨æ€§ä¿è¯

### SQL æ³¨å…¥é˜²æŠ¤ âœ…

Intent-Engine ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆprepared statementsï¼‰ï¼Œå®Œå…¨é˜²æ­¢ SQL æ³¨å…¥æ”»å‡»ã€‚

**æµ‹è¯•æ¡ˆä¾‹**ï¼š
```rust
// å°è¯• SQL æ³¨å…¥
let malicious = "Task'; DROP TABLE tasks; --";
task_mgr.add_task(malicious, None, None).await.unwrap();

// âœ… ç»“æœï¼šæ¶æ„ä»£ç è¢«å½“ä½œæ™®é€šå­—ç¬¦ä¸²å¤„ç†ï¼Œè¡¨æœªè¢«åˆ é™¤
```

**éªŒè¯**ï¼š
- âœ… å•å¼•å·æ³¨å…¥
- âœ… UNION SELECT æ³¨å…¥
- âœ… æ³¨é‡Šç¬¦ `--` å’Œ `/**/`
- âœ… äº‹ä»¶æ•°æ®ä¸­çš„ SQL å‘½ä»¤

## Unicode æ”¯æŒ

### å¤šè¯­è¨€å­—ç¬¦ âœ…

å®Œå…¨æ”¯æŒ Unicode å­—ç¬¦ï¼ŒåŒ…æ‹¬å„ç§è¯­è¨€ï¼š

```rust
// ä¸­æ–‡
"å®ç°ç”¨æˆ·è®¤è¯åŠŸèƒ½"

// æ—¥æ–‡
"ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè£…ã™ã‚‹"

// é˜¿æ‹‰ä¼¯æ–‡
"ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù‡Ù…Ø©"

// æ··åˆè¯­è¨€
"å®ç° authentication èªè¨¼ Ù…ØµØ§Ø¯Ù‚Ø©"
```

**éªŒè¯**ï¼š
- âœ… ä¸­æ–‡å­—ç¬¦å­˜å‚¨å’Œæ£€ç´¢
- âœ… æ—¥æ–‡å­—ç¬¦å­˜å‚¨å’Œæ£€ç´¢
- âœ… é˜¿æ‹‰ä¼¯æ–‡ï¼ˆRTLï¼‰å­—ç¬¦
- âœ… æ··åˆè¯­è¨€å†…å®¹

### Emoji æ”¯æŒ âœ…

å®Œå…¨æ”¯æŒ Emoji è¡¨æƒ…ç¬¦å·ï¼ŒåŒ…æ‹¬å¤åˆ emojiï¼š

```rust
// ç®€å• emoji
"ğŸš€ Deploy to production ğŸ‰"

// å¤åˆ emoji
"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family task ğŸ³ï¸â€ğŸŒˆ ğŸ‡ºğŸ‡¸"
```

**éªŒè¯**ï¼š
- âœ… åŸºæœ¬ emojiï¼ˆğŸš€ğŸ‰ğŸ’»ï¼‰
- âœ… å¤åˆ emoji åºåˆ—ï¼ˆğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ï¼‰
- âœ… å›½æ—— emojiï¼ˆğŸ‡ºğŸ‡¸ï¼‰
- âœ… å˜ä½“é€‰æ‹©å™¨ï¼ˆğŸ³ï¸â€ğŸŒˆï¼‰

## JSON ç‰¹æ®Šå­—ç¬¦

### å¼•å·å’Œè½¬ä¹‰ âœ…

æ­£ç¡®å¤„ç† JSON ä¸­éœ€è¦è½¬ä¹‰çš„å­—ç¬¦ï¼š

```rust
// åŒå¼•å·
r#"Task with "quoted" text"#

// åæ–œæ 
r"C:\Users\test\path"

// æ§åˆ¶å­—ç¬¦
"Task\nwith\nnewlines\tand\ttabs"
```

**JSON è¾“å‡º**ï¼š
```json
{
  "name": "Task with \"quoted\" text"
}
```

**éªŒè¯**ï¼š
- âœ… åŒå¼•å·æ­£ç¡®è½¬ä¹‰ä¸º `\"`
- âœ… åæ–œæ æ­£ç¡®è½¬ä¹‰ä¸º `\\`
- âœ… æ¢è¡Œç¬¦è½¬ä¹‰ä¸º `\n`
- âœ… åˆ¶è¡¨ç¬¦è½¬ä¹‰ä¸º `\t`

### Null å­—èŠ‚å¤„ç† âš ï¸

SQLite ä¸æ”¯æŒæ–‡æœ¬ä¸­çš„ null å­—èŠ‚ï¼ˆ`\0`ï¼‰ã€‚ç³»ç»Ÿä¼šï¼š
- é€‰é¡¹ 1: æ‹’ç»åŒ…å« null å­—èŠ‚çš„è¾“å…¥
- é€‰é¡¹ 2: è‡ªåŠ¨ç§»é™¤ null å­—èŠ‚

**å»ºè®®**ï¼šé¿å…åœ¨è¾“å…¥ä¸­ä½¿ç”¨ null å­—èŠ‚ã€‚

## æ§åˆ¶å­—ç¬¦

### å¤šè¡Œå†…å®¹ âœ…

å®Œå…¨æ”¯æŒå¤šè¡Œæ–‡æœ¬ï¼š

```rust
let multiline_spec = r#"# Task Specification

## Requirements
1. Feature A
2. Feature B

## Notes
- Important detail
"#;

task_mgr.add_task("Task", Some(multiline_spec), None).await
```

**éªŒè¯**ï¼š
- âœ… æ¢è¡Œç¬¦ï¼ˆ`\n`ï¼‰
- âœ… å›è½¦æ¢è¡Œï¼ˆ`\r\n`ï¼‰
- âœ… åˆ¶è¡¨ç¬¦ï¼ˆ`\t`ï¼‰
- âœ… å¤šä¸ªè¿ç»­ç©ºæ ¼

## æç«¯é•¿åº¦

### è¶…é•¿è¾“å…¥ âœ…

ç³»ç»Ÿæ”¯æŒæé•¿çš„è¾“å…¥ï¼š

| å­—æ®µ | æµ‹è¯•é•¿åº¦ | çŠ¶æ€ | è¯´æ˜ |
|------|---------|------|------|
| ä»»åŠ¡åç§° | 10,000 å­—ç¬¦ | âœ… | æ— é™åˆ¶ |
| è§„æ ¼è¯´æ˜ | 35,000 å­—ç¬¦ | âœ… | æ— é™åˆ¶ |
| äº‹ä»¶æ•°æ® | 120,000 å­—ç¬¦ | âœ… | æ— é™åˆ¶ |

**æ€§èƒ½**ï¼š
- 10,000 å­—ç¬¦ä»»åŠ¡åï¼šæ­£å¸¸å­˜å‚¨å’Œæ£€ç´¢
- è¶…é•¿æ–‡æœ¬ä¸å½±å“æŸ¥è¯¢æ€§èƒ½
- JSON åºåˆ—åŒ–æ­£å¸¸å·¥ä½œ

## è¾¹ç•Œæƒ…å†µ

### ç©ºå’Œæå°è¾“å…¥ âœ…

```rust
// ç©ºå­—ç¬¦ä¸²ï¼ˆå…è®¸ï¼‰
task_mgr.add_task("", None, None).await.unwrap()

// çº¯ç©ºæ ¼ï¼ˆå…è®¸ï¼‰
task_mgr.add_task("     ", None, None).await.unwrap()

// å•å­—ç¬¦
task_mgr.add_task("A", None, None).await.unwrap()
```

**éªŒè¯**ï¼š
- âœ… ç©ºä»»åŠ¡åï¼ˆå…è®¸ä½†ä¸æ¨èï¼‰
- âœ… çº¯ç©ºæ ¼ä»»åŠ¡å
- âœ… å•å­—ç¬¦ä»»åŠ¡å
- âœ… ç©ºè§„æ ¼è¯´æ˜
- âœ… ç©ºäº‹ä»¶æ•°æ®

## ç‰¹æ®Šç¬¦å·ç»„åˆ

### Shell å…ƒå­—ç¬¦ âœ…

å®‰å…¨å¤„ç† Shell å‘½ä»¤ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼š

```rust
"Task && echo 'test' | grep -v 'bad' > /dev/null"
```

**éªŒè¯**ï¼š
- âœ… ç®¡é“ `|`
- âœ… é‡å®šå‘ `>` `<`
- âœ… é€»è¾‘è¿ç®—ç¬¦ `&&` `||`
- âœ… å‘½ä»¤æ›¿æ¢ `` `command` ``

### Markdown/HTML âœ…

```rust
// Markdown
"# Task **bold** *italic* `code`"

// HTML
"<script>alert('xss')</script>"
```

**æ³¨æ„**ï¼šç³»ç»Ÿä¸è¿‡æ»¤æˆ–è½¬ä¹‰è¿™äº›å­—ç¬¦ï¼ŒåŸæ ·å­˜å‚¨ã€‚å®¢æˆ·ç«¯è´Ÿè´£å®‰å…¨æ¸²æŸ“ã€‚

### æ­£åˆ™è¡¨è¾¾å¼å…ƒå­—ç¬¦ âœ…

```rust
r"Task.*[0-9]+\d{3}(test|prod)$"
```

æ‰€æœ‰æ­£åˆ™å…ƒå­—ç¬¦éƒ½è¢«æ­£ç¡®å­˜å‚¨å’Œæ£€ç´¢ã€‚

### URL å’Œè·¯å¾„ âœ…

```rust
// URL with query parameters
"Deploy to https://example.com/api?key=value&test=1"

// Windows path
r"C:\Users\test\Documents\file.txt"

// Unix path
"/home/user/project/file.txt"
```

## FTS5 å…¨æ–‡æœç´¢é™åˆ¶

### è‹±æ–‡æœç´¢ âœ…

å¯¹è‹±æ–‡å†…å®¹çš„å…¨æ–‡æœç´¢å·¥ä½œå®Œç¾ï¼š

```rust
task: "Implement authentication feature"
search: "authentication" // âœ… æ‰¾åˆ°
```

### CJK è¯­è¨€é™åˆ¶ âš ï¸

SQLite FTS5 çš„ unicode61 tokenizer å¯¹ä¸­æ—¥éŸ©ï¼ˆCJKï¼‰è¯­è¨€çš„åˆ†è¯æ”¯æŒæœ‰é™ï¼š

```rust
task: "å®ç°ç”¨æˆ·è®¤è¯åŠŸèƒ½"
search: "è®¤è¯" // âš ï¸ å¯èƒ½æ— æ³•æ‰¾åˆ°ï¼ˆéœ€è¦å®Œæ•´åŒ¹é…ï¼‰
search: "å®ç°ç”¨æˆ·è®¤è¯åŠŸèƒ½" // âœ… å¯ä»¥æ‰¾åˆ°ï¼ˆå®Œæ•´åŒ¹é…ï¼‰
```

**å»ºè®®**ï¼š
- å¯¹ CJK å†…å®¹ä½¿ç”¨å®Œæ•´çŸ­è¯­æœç´¢
- è€ƒè™‘ä½¿ç”¨ä»»åŠ¡åç§°å‰ç¼€çš„è‹±æ–‡å…³é”®è¯
- å¯¹ä¸­æ–‡ä»»åŠ¡ä½¿ç”¨é FTS çš„æ ‡å‡†è¿‡æ»¤

**æ”¹è¿›æ–¹å‘**ï¼š
æœªæ¥å¯è€ƒè™‘é›†æˆä¸“ç”¨çš„ CJK åˆ†è¯å™¨ï¼ˆå¦‚ jiebaã€mecab ç­‰ï¼‰ã€‚

## CLI ç‰¹æ®Šå­—ç¬¦å¤„ç†

### Shell å¼•å· âœ…

åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨å¼•å·ä¿æŠ¤ç‰¹æ®Šå­—ç¬¦ï¼š

```bash
# æ­£ç¡®
intent-engine task add --name "Task with spaces"
intent-engine task add --name 'Task with "quotes"'

# Unicode
intent-engine task add --name "å®ç°åŠŸèƒ½"

# Emoji
intent-engine task add --name "ğŸš€ Deploy"
```

### stdin è¾“å…¥ âœ…

å¤æ‚å†…å®¹é€šè¿‡ stdin ä¼ é€’ï¼š

```bash
echo "Multi-line\nspecification\nwith special chars" | \
  intent-engine task add --name "Task" --spec-stdin
```

## æµ‹è¯•è¦†ç›–ç»Ÿè®¡

### å•å…ƒæµ‹è¯•

- **ç‰¹æ®Šå­—ç¬¦æµ‹è¯•**: 37 ä¸ªæµ‹è¯•
  - SQL æ³¨å…¥: 4 ä¸ªæµ‹è¯•
  - Unicode/Emoji: 7 ä¸ªæµ‹è¯•
  - JSON ç‰¹æ®Šå­—ç¬¦: 4 ä¸ªæµ‹è¯•
  - æ§åˆ¶å­—ç¬¦: 4 ä¸ªæµ‹è¯•
  - æç«¯é•¿åº¦: 3 ä¸ªæµ‹è¯•
  - è¾¹ç•Œæƒ…å†µ: 5 ä¸ªæµ‹è¯•
  - ç‰¹æ®Šç¬¦å·: 7 ä¸ªæµ‹è¯•
  - FTS5 æœç´¢: 3 ä¸ªæµ‹è¯•

### CLI é›†æˆæµ‹è¯•

- **CLI ç‰¹æ®Šå­—ç¬¦æµ‹è¯•**: 10 ä¸ªæµ‹è¯•
  - Unicode å’Œ Emoji é€šè¿‡ CLI
  - å¤šè¡Œå’Œå¼•å·å¤„ç†
  - æé•¿è¾“å…¥
  - ç‰¹æ®Šç¬¦å·ç»„åˆ

## æœ€ä½³å®è·µ

### å¯¹å¼€å‘è€…

1. **æ°¸è¿œä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢** - å·²å†…ç½®ï¼Œæ— éœ€é¢å¤–æ“ä½œ
2. **ä¸è¦è¿‡æ»¤ç”¨æˆ·è¾“å…¥** - ä¿æŒåŸå§‹è¾“å…¥å®Œæ•´æ€§
3. **ä¾èµ– JSON åºåˆ—åŒ–** - serde_json è‡ªåŠ¨å¤„ç†è½¬ä¹‰

### å¯¹ç”¨æˆ·

1. **Shell å¼•å·ä½¿ç”¨**
   ```bash
   # å•å¼•å·ä¿æŠ¤å¤§éƒ¨åˆ†ç‰¹æ®Šå­—ç¬¦
   intent-engine task add --name 'Task with $var'

   # åŒå¼•å·å…è®¸å˜é‡å±•å¼€
   intent-engine task add --name "Task for $USER"
   ```

2. **å¤æ‚å†…å®¹ä½¿ç”¨ stdin**
   ```bash
   cat spec.md | intent-engine task add --name "Task" --spec-stdin
   ```

3. **CJK æœç´¢æç¤º**
   - ä½¿ç”¨å®Œæ•´çŸ­è¯­è€Œéå•ä¸ªè¯
   - è€ƒè™‘æ·»åŠ è‹±æ–‡å…³é”®è¯

## å®‰å…¨å£°æ˜

Intent-Engine çš„å®‰å…¨ç‰¹æ€§ï¼š

âœ… **SQL æ³¨å…¥**: å®Œå…¨é˜²æŠ¤ï¼ˆå‚æ•°åŒ–æŸ¥è¯¢ï¼‰
âœ… **å‘½ä»¤æ³¨å…¥**: ä¸æ‰§è¡Œå¤–éƒ¨å‘½ä»¤ï¼Œæ— é£é™©
âœ… **XSS é˜²æŠ¤**: å­˜å‚¨å±‚ä¸æ‰§è¡Œè½¬ä¹‰ï¼Œç”±å±•ç¤ºå±‚è´Ÿè´£
âœ… **è·¯å¾„éå†**: ä»…æ“ä½œæŒ‡å®šçš„æ•°æ®åº“æ–‡ä»¶
âœ… **DoS é˜²æŠ¤**: SQLite äº‹åŠ¡å’Œè¶…æ—¶æœºåˆ¶

## è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰ç‰¹æ®Šå­—ç¬¦æµ‹è¯•
cargo test --test special_chars_tests

# è¿è¡Œ CLI ç‰¹æ®Šå­—ç¬¦æµ‹è¯•
cargo test --test cli_special_chars_tests

# è¿è¡Œç‰¹å®šæµ‹è¯•
cargo test test_sql_injection
cargo test test_unicode
cargo test test_emoji
```

## å·²çŸ¥é™åˆ¶

1. **Null å­—èŠ‚**: SQLite æ–‡æœ¬å­—æ®µä¸æ”¯æŒ null å­—èŠ‚
2. **FTS5 CJK åˆ†è¯**: å¯¹ä¸­æ—¥éŸ©è¯­è¨€åˆ†è¯æ”¯æŒæœ‰é™
3. **è¶…å¤§æ–‡æœ¬**: è™½ç„¶æ”¯æŒï¼Œä½† JSON åºåˆ—åŒ–è¶…å¤§æ–‡æœ¬å¯èƒ½å½±å“æ€§èƒ½

## æ€»ç»“

Intent-Engine å¯¹ç‰¹æ®Šå­—ç¬¦å’Œè¾¹ç•Œæƒ…å†µçš„å¤„ç†ï¼š

- âœ… **å®‰å…¨æ€§**: SQL æ³¨å…¥å®Œå…¨é˜²æŠ¤
- âœ… **å›½é™…åŒ–**: å®Œå…¨æ”¯æŒ Unicode å’Œ Emoji
- âœ… **é²æ£’æ€§**: æ­£ç¡®å¤„ç†å„ç§è¾¹ç•Œæƒ…å†µ
- âœ… **å®Œæ•´æ€§**: ä¿æŒåŸå§‹è¾“å…¥ä¸å˜
- âš ï¸ **æœç´¢é™åˆ¶**: FTS5 å¯¹ CJK è¯­è¨€åˆ†è¯æœ‰é™

ç³»ç»Ÿç»è¿‡ 47 ä¸ªä¸“é—¨æµ‹è¯•éªŒè¯ï¼Œç¡®ä¿åœ¨å®é™…ä½¿ç”¨ä¸­çš„å¯é æ€§ã€‚
