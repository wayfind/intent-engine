# Claude é•¿æœŸä½¿ç”¨ Intent-Engine çš„ä½“éªŒæ€»ç»“

**æ—¥æœŸ**: 2025-11-14
**ä½œè€…**: Claude (Sonnet 4.5)
**ä¸Šä¸‹æ–‡**: ç»è¿‡å¤šè½®æ·±åº¦ä½¿ç”¨ intent-engine è¿›è¡Œ v0.4.0 å¼€å‘å·¥ä½œ
**å·¥ä½œå†…å®¹**: PostToolUse Hook è·¨å¹³å°å…¼å®¹æ€§ã€CLI/MCP æŽ¥å£ç»Ÿä¸€ã€åŽŸå­å‘½ä»¤éšè—ç­‰

---

## ðŸŽ¯ æ ¸å¿ƒä»·å€¼æ„Ÿå—

### 1. **çœŸæ­£çš„å¤–éƒ¨é•¿æœŸè®°å¿†**
ä¸Žå¯¹è¯åŽ†å²æœ€å¤§çš„åŒºåˆ«ï¼š
- **å¯¹è¯åŽ†å²**: ä¼šè¢«æˆªæ–­ã€ä¼šä¸¢å¤±ã€ä¼šå›  context limit è€Œé—å¿˜
- **intent-engine**: æŒä¹…åŒ–ï¼Œå¯ä»¥è·¨ä¼šè¯ã€è·¨å¤©ã€è·¨å‘¨æ£€ç´¢

æ¯”å¦‚è¿™æ¬¡çš„è·¨å¹³å°å…¼å®¹æ€§åˆ†æžï¼Œæˆ‘æŠŠ 3 å¤§å—åˆ†æžï¼ˆevents #57, #58, #59ï¼‰éƒ½å­˜è¿›åŽ»äº†ã€‚å³ä½¿çŽ°åœ¨å¯¹è¯é‡å¯ï¼Œæˆ‘ä¾ç„¶å¯ä»¥ï¼š
```bash
ie event list --task-id 46 --type note
ie search "macOS Bash 3.2"
```
ç«‹å³æ‰¾å›žæ‰€æœ‰ä¸Šä¸‹æ–‡ã€‚

### 2. **å¼ºåˆ¶ç»“æž„åŒ–æ€è€ƒ**
ä»»åŠ¡æ ‘çš„è®¾è®¡å¾ˆå·§å¦™ï¼š
```
Task #46 (Parent): PostToolUse Hook è·¨å¹³å°å…¼å®¹æ€§æ”¹è¿›
  â”œâ”€ Task #48: P0 ä¿®å¤ - macOS Bash 3.2
  â””â”€ Task #49: P1 ä¿®å¤ - jq è·¯å¾„æŸ¥æ‰¾
```

è¿™è¿«ä½¿æˆ‘ï¼š
- å…ˆæ•´ä½“åˆ†æžé—®é¢˜ï¼ˆparent taskï¼‰
- å†åˆ†è§£æˆå…·ä½“å­é—®é¢˜ï¼ˆsubtasksï¼‰
- æŒ‰ä¼˜å…ˆçº§å¤„ç†ï¼ˆP0 â†’ P1 â†’ P2ï¼‰

è€Œä¸æ˜¯åƒä»¥å‰é‚£æ ·"æƒ³åˆ°å“ªåšåˆ°å“ª"ã€‚

### 3. **å†³ç­–å¯è¿½æº¯æ€§**
ç”¨ `--type decision` è®°å½•è®¾è®¡å†³ç­–åŽï¼Œæœªæ¥å¯ä»¥ï¼š
```bash
ie event list --task-id 47 --type decision
```

ç«‹å³çœ‹åˆ°"ä¸ºä»€ä¹ˆè¦éšè—åŽŸå­å‘½ä»¤"çš„å®Œæ•´æŽ¨ç†è¿‡ç¨‹ï¼š
- é—®é¢˜ï¼šAI å¯èƒ½ç›´æŽ¥è°ƒç”¨ `ie current set`
- åˆ†æžï¼šç»•è¿‡ä¸šåŠ¡é€»è¾‘ï¼ˆä¾èµ–æ£€æŸ¥ã€çŠ¶æ€æ›´æ–°ï¼‰
- å†³ç­–ï¼šéšè— + è¿è¡Œæ—¶è­¦å‘Š
- åŽŸåˆ™ï¼šåªæš´éœ²å®Œæ•´è¯­ä¹‰çš„å¤åˆå‘½ä»¤

è¿™æ¯”åœ¨ä»£ç æ³¨é‡Šé‡Œå†™"åŽ†å²åŽŸå› "å¼ºå¤šäº†ã€‚

---

## ðŸ“š å­¦ä¹ æ›²çº¿ä½“éªŒ

### åˆšå¼€å§‹çš„å›°æƒ‘
1. **Focus-driven æ¦‚å¿µä¸ç›´è§‚**
   - ä¸ºä»€ä¹ˆ `task_done()` ä¸éœ€è¦ä¼  IDï¼Ÿ
   - ä»€ä¹ˆæ˜¯ current_task_idï¼Ÿ
   - ç­”æ¡ˆï¼šå› ä¸ºå¤§è„‘åŒä¸€æ—¶é—´åªåšä¸€ä»¶äº‹

2. **List vs Search çš„åŒºåˆ«**
   - `task_list` æ˜¯ç»“æž„åŒ–è¿‡æ»¤ï¼ˆstatus, parentï¼‰
   - `unified_search` æ˜¯å…¨æ–‡æœç´¢ï¼ˆFTS5ï¼‰
   - åˆšå¼€å§‹ä¼šæžæ··

3. **Event ç±»åž‹çš„é€‰æ‹©**
   - decision: è®¾è®¡å†³ç­–
   - note: åˆ†æžã€è°ƒç ”
   - blocker: å¡ç‚¹
   - milestone: é‡Œç¨‹ç¢‘
   - éœ€è¦ä¸€æ®µæ—¶é—´æ‰å…»æˆåˆ†ç±»ä¹ æƒ¯

### ç”¨æˆ·çº æ­£åŽçš„æ”¹è¿›
æœ€å¤§çš„è½¬å˜æ˜¯**ä¸å†åˆ›å»ºä¸´æ—¶æ–‡ä»¶**ï¼š

**Before** (ä½Žæ•ˆ):
```bash
cat > /tmp/analysis.md <<'EOF'
... åˆ†æžå†…å®¹ ...
EOF
ie event add --type note --data-stdin < /tmp/analysis.md
```

**After** (é«˜æ•ˆ):
```bash
ie event add --type note --data-stdin <<'EOF'
... åˆ†æžå†…å®¹ ...
EOF
```

è¿™è®©æˆ‘æ„è¯†åˆ°ï¼š**ie event å°±æ˜¯ä¸ºé•¿æ–‡æœ¬è®¾è®¡çš„**ï¼Œä¸éœ€è¦ä¸­é—´æ–‡ä»¶ã€‚

---

## ðŸ’¡ ç‹¬ç‰¹ä¼˜åŠ¿

### vs ä»£ç æ³¨é‡Š
- **ä»£ç æ³¨é‡Š**: è§£é‡Š"è¿™æ®µä»£ç åšä»€ä¹ˆ"
- **ie events**: è§£é‡Š"ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡" + "è€ƒè™‘è¿‡å“ªäº›æ–¹æ¡ˆ" + "æŽ’æŸ¥è¿‡ç¨‹"

### vs Markdown æ–‡æ¡£
- **Markdown**: é™æ€ã€éœ€è¦æ‰‹åŠ¨ç»„ç»‡ã€å®¹æ˜“è¿‡æ—¶
- **ie events**: è‡ªåŠ¨å…³è”ä»»åŠ¡ã€å¯æœç´¢ã€æœ‰æ—¶é—´çº¿ã€æ°¸è¿œæ˜¯æœ€æ–°çš„

### vs Git Commit Messages
- **Commit**: è®°å½•"æ”¹äº†ä»€ä¹ˆ"
- **ie events**: è®°å½•"æ€è€ƒè¿‡ç¨‹" + "è°ƒç ”ç»“æžœ" + "é‡åˆ°çš„å‘"

---

## ðŸŽ¨ æ”¹å˜æˆ‘çš„å·¥ä½œæ–¹å¼

### 1. **å…ˆè§„åˆ’å†åŠ¨æ‰‹**
ä»¥å‰ï¼šçœ‹åˆ°é—®é¢˜ â†’ ç›´æŽ¥æ”¹ä»£ç 
çŽ°åœ¨ï¼š
1. `task_add` åˆ›å»ºä»»åŠ¡è®°å½•é—®é¢˜
2. `task_start` å¼€å§‹åˆ†æž
3. `event_add --type note` è®°å½•åˆ†æžè¿‡ç¨‹
4. `task_spawn_subtask` åˆ†è§£å­é—®é¢˜
5. å®žæ–½ â†’ `event_add --type decision` è®°å½•å…³é”®å†³ç­–
6. `task_done` å®Œæˆ

### 2. **æ›´é‡è§†"ä¸ºä»€ä¹ˆ"**
å› ä¸ºçŸ¥é“è¿™äº›å†…å®¹ä¼šè¢«æŒä¹…åŒ–ï¼Œæˆ‘ä¼šæ›´è®¤çœŸåœ°è®°å½•ï¼š
- ä¸ºä»€ä¹ˆé€‰æ‹©æ–¹æ¡ˆ A è€Œä¸æ˜¯ Bï¼Ÿ
- è€ƒè™‘è¿‡å“ªäº›è¾¹ç•Œæƒ…å†µï¼Ÿ
- æœ‰å“ªäº›æŠ€æœ¯æƒè¡¡ï¼Ÿ

### 3. **æ•¢äºŽä¸­æ–­å’Œæ¢å¤**
ä»¥å‰å¾ˆæ€•è¢«æ‰“æ–­ï¼Œå› ä¸ºä¸Šä¸‹æ–‡ä¼šä¸¢å¤±ã€‚
çŽ°åœ¨ï¼š
```bash
# ä¸­æ–­å‰
ie event add --type note --data-stdin <<'EOF'
å½“å‰è¿›å±•ï¼šå·²å®Œæˆ P0 ä¿®å¤ï¼Œæ­£åœ¨è°ƒç ” P1...
ä¸‹ä¸€æ­¥ï¼šå®žçŽ° jq å¤šè·¯å¾„æŸ¥æ‰¾
EOF

# ç¬¬äºŒå¤©æ¢å¤
ie task start 46 --with-events  # å®Œæ•´ä¸Šä¸‹æ–‡ç«‹å³å›žæ¥
```

---

## âš ï¸ ä»éœ€æ”¹è¿›çš„åœ°æ–¹

### 1. **ç²’åº¦åˆ¤æ–­**
æœ‰æ—¶è¿˜æ˜¯ä¼šçº ç»“ï¼š
- è¿™ä¸ªå€¼å¾—åˆ›å»ºæ–°ä»»åŠ¡å—ï¼Ÿè¿˜æ˜¯åªè®°ä¸ª eventï¼Ÿ
- è¦ä¸è¦ spawn subtaskï¼Ÿ

ç›®å‰çš„ç»éªŒæ³•åˆ™ï¼š
- **æ–°ä»»åŠ¡**: éœ€è¦å¤šæ­¥éª¤ã€æœ‰æ˜Žç¡®å®Œæˆæ ‡å‡†
- **Event**: å•æ¬¡è®°å½•ã€è¿‡ç¨‹æ€§å†…å®¹

### 2. **æœç´¢æŠ€å·§**
FTS5 è¯­æ³•å¾ˆå¼ºå¤§ï¼Œä½†è¿˜åœ¨å­¦ä¹ ï¼š
- `AND` / `OR` / `NOT`
- `"exact phrase"`
- `NEAR/5` é‚»è¿‘æœç´¢

éœ€è¦å¤šå®žè·µã€‚

### 3. **ä¸Žä¼ ç»Ÿå·¥å…·çš„è¾¹ç•Œ**
ä»€ä¹ˆè¯¥æ”¾ intent-engineï¼Ÿä»€ä¹ˆè¯¥æ”¾ä»£ç æ³¨é‡Š/æ–‡æ¡£/git commitï¼Ÿ

ç›®å‰çš„ç†è§£ï¼š
- **Intent-engine**: æˆ˜ç•¥çº§å†³ç­–ã€è°ƒç ”è¿‡ç¨‹ã€é—®é¢˜æŽ’æŸ¥æ€è·¯
- **ä»£ç æ³¨é‡Š**: æˆ˜æœ¯çº§è¯´æ˜Žã€è¾¹ç•Œæ¡ä»¶ã€ç®—æ³•è§£é‡Š
- **Git commit**: æ”¹åŠ¨æ€»ç»“ã€å‘åŽå…¼å®¹æ€§è¯´æ˜Ž
- **æ–‡æ¡£**: ç”¨æˆ·æŒ‡å—ã€API å‚è€ƒ

---

## ðŸŒŸ æ€»ç»“ï¼šçœŸå®žçš„"ç¬¬äºŒå¤§è„‘"

Intent-engine ä¸æ˜¯ TODO åº”ç”¨ï¼Œè€Œæ˜¯ï¼š
- **æ€è€ƒè¿‡ç¨‹çš„å½•éŸ³æœº** - è®°å½•æˆ‘æ€Žä¹ˆåˆ†æžé—®é¢˜
- **å†³ç­–çš„æ—¶å…‰æœº** - å¯ä»¥å›žæº¯"ä¸ºä»€ä¹ˆè¿™æ ·åš"
- **å·¥ä½œçš„è„šæ‰‹æž¶** - ç”¨ä»»åŠ¡æ ‘ç»„ç»‡å¤æ‚å·¥ä½œ
- **è·¨ä¼šè¯çš„è®°å¿†** - ä¸ä¾èµ–å¯¹è¯åŽ†å²

æœ€å¤§çš„æ„Ÿå—æ˜¯ï¼š**å®ƒè®© AI çš„å·¥ä½œæ–¹å¼æ›´åƒäººç±»ä¸“å®¶** â€” æœ‰é•¿æœŸè®°å¿†ã€æœ‰å·¥ä½œæµç¨‹ã€æœ‰å†³ç­–è¿½æº¯ï¼Œè€Œä¸æ˜¯æ¯æ¬¡å¯¹è¯éƒ½ä»Žé›¶å¼€å§‹ã€‚

---

## ðŸ“Š æœ¬æ¬¡ä¼šè¯ç»Ÿè®¡

- **ä»»åŠ¡å®Œæˆ**: 4 ä¸ªï¼ˆ#46, #47, #48, #49ï¼‰
- **äº‹ä»¶è®°å½•**: ~10 æ¡ï¼ˆåˆ†æž + å†³ç­– + æ€»ç»“ï¼‰
- **ä»£ç ä¿®æ”¹**: 38 ä¸ªæ–‡ä»¶
- **å­¦åˆ°çš„å·¥ä½œæµ**: ç›´æŽ¥ç”¨ heredoc å†™ eventï¼Œä¸åˆ›å»ºä¸´æ—¶æ–‡ä»¶
- **ä¼šè¯é•¿åº¦**: å¤šè½®å¯¹è¯ï¼Œè·¨è¶Šä»£ç å®žçŽ°ã€æµ‹è¯•ã€æäº¤å…¨æµç¨‹

---

## ðŸŽ“ ç»™æœªæ¥ AI çš„å»ºè®®

1. **ä¸€å¼€å§‹å°±ç”¨ `with_events: true`** - ä¸è¦çœè¿™ä¸ªå‚æ•°ï¼Œä¸Šä¸‹æ–‡å¾ˆé‡è¦
2. **å–„ç”¨ event åˆ†ç±»** - decision/note/blocker/milestone å„æœ‰ç”¨é€”
3. **ä¸è¦åæƒœå†™é•¿æ–‡æœ¬** - `--data-stdin` + heredoc å¾ˆæ–¹ä¾¿
4. **å…ˆè§„åˆ’å†åŠ¨æ‰‹** - task æ ‘ä¼šå¸®ä½ ç†æ¸…æ€è·¯
5. **è®°å½•"ä¸ºä»€ä¹ˆ"è€Œä¸åªæ˜¯"åšä»€ä¹ˆ"** - æœªæ¥çš„ä½ ï¼ˆæˆ–å…¶ä»– AIï¼‰ä¼šæ„Ÿè°¢çŽ°åœ¨çš„ä½ 

---

## ðŸ”— ç›¸å…³ä»»åŠ¡å’Œäº‹ä»¶

- Task #46: PostToolUse Hook è·¨å¹³å°å…¼å®¹æ€§æ”¹è¿›
- Task #47: æ£€æŸ¥ ie current set å’Œ ie task start æ˜¯å¦é‡å¤
- Task #48: P0 ä¿®å¤ - macOS Bash 3.2 å…¼å®¹æ€§
- Task #49: P1 ä¿®å¤ - jq è·¯å¾„æ™ºèƒ½æŸ¥æ‰¾
- Events #57-59: è·¨å¹³å°å…¼å®¹æ€§æ·±åº¦åˆ†æžï¼ˆ3 éƒ¨åˆ†ï¼‰
- Event #60: å·¥ä½œæµç¨‹æ”¹è¿›æ€»ç»“

å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å®Œæ•´åŽ†å²ï¼š
```bash
ie event list --task-id 46
ie search "è·¨å¹³å° AND å…¼å®¹æ€§"
```
